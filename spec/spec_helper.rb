require "./lib/helpers/parsable"
require "./lib/sections/vnum_section"

# This file was generated by the `rspec --init` command. Conventionally, all
# specs live under a `spec` directory, which RSpec adds to the `$LOAD_PATH`.
# Require this file using `require "spec_helper"` to ensure that it is only
# loaded once.
#
# See http://rubydoc.info/gems/rspec-core/RSpec/Core/Configuration
RSpec.configure do |config|
  config.treat_symbols_as_metadata_keys_with_true_values = true
  config.run_all_when_everything_filtered = true

  # Run specs in random order to surface order dependencies. If you find an
  # order dependency and want to debug it, you can fix the order by providing
  # the seed, which is printed after each run.
  #     --seed 1234
  config.order = 'random'
end

def expect_one_error(item, message, printout=false)
  item.parse
  p item.errors if printout
  expect(item.errors.length).to eq(1)
  expect(item.errors.first.description).to eq(message)
end

shared_examples_for Parsable do
  it "marks itself as parsed" do
    item.parse

    expect(item.parsed?).to be_true
  end
end

shared_examples_for Section do
  it "ignores leading and trailing white space" do
    section.contents.prepend("\n"*10)
    section.contents << "\n"*10

    section.parse
    expect(section.errors).to be_empty
  end
end

shared_examples_for VnumSection do
  it "detects duplicate vnums" do
    section.parse

    expect_one_error(section, "baah")
  end
end
